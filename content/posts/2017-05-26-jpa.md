+++
draft = true
date = "2017-05-26"
title = "Getting database autogenerated values after saving entity"
description = "???"
categories = ["java", "spring"]
tags = ["java", "spring", "springboot", "jpa", "hibernate"]
+++

### Problem

```xml
<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">

    <changeSet id="20160526-kowolm-1" author="kowolm">
        <createTable tableName="foo">
            <column name="id" type="UUID">
                <constraints nullable="false" primaryKey="true" primaryKeyName="editorial_collections_pk"/>
            </column>
            <column name="date_created" type="timestamp with time zone" defaultValueComputed="now()">
                <constraints nullable="false"/>
            </column>
            <column name="date_modified" type="timestamp with time zone" defaultValueComputed="now()">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createProcedure>
            CREATE OR REPLACE FUNCTION update_date_modified()
            RETURNS trigger AS $$
            BEGIN
            NEW.date_modified := NOW();
            RETURN NEW;
            END;
            $$ LANGUAGE plpgsql;
        </createProcedure>

        <sql>
            CREATE TRIGGER update_editorial_collections_date_modified
            BEFORE UPDATE ON editorial_collections
            FOR EACH ROW EXECUTE PROCEDURE update_date_modified();
        </sql>
    </changeSet>

</databaseChangeLog>
```

```java
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
@Entity(name = FOO)
public class Foo implements Serializable {

    @Id
    @Column(name = "id")
    private UUID id;

    @Column(name = "date_created", insertable = false, updatable = false)
    private ZonedDateTime dateCreated;

    @Column(name = "date_modified", insertable = false, updatable = false)
    private ZonedDateTime dateModified;

}
```

If I use `org.springframework.data.repository.CrudRepository` to save entity without `dateCreated` and `dateModified`, then value reurned by `repository.save(entity)` will not have dates from database.

### Solution

Simply add `org.hibernate.annotations.Generated` annotation with `GenerationTime.ALWAYS` or `GenerationTime.INSERT`.

```java
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
@Entity(name = FOO)
public class Foo implements Serializable {

    @Id
    @Column(name = "id")
    private UUID id;

    @GeneratedValue
    @Generated(GenerationTime.ALWAYS)
    @Column(name = "date_created", insertable = false, updatable = false)
    private ZonedDateTime dateCreated;

    @GeneratedValue
    @Generated(GenerationTime.ALWAYS)
    @Column(name = "date_modified", insertable = false, updatable = false)
    private ZonedDateTime dateModified;

}
```

Other solution (to check): Use `EntityListener`